## 类型信息

RTTI(Run-time type information)运行时类型信息，使得你可以在程序运行时发现和使用类型信息

### Class对象

1.要理解RTTI在Java中的工作原理，首先必须知道类型信息在运行时是如何表示的，这项工作是由称为Class对象的特殊对象完成的，它包含了与类有关的信息。Java使用Class对象来执行其RTTI，如转型这样的操作。Class还拥有大量使用RTTI的其他方式。

2.所有的类都是在对其第一次使用时，动态加载到JVM中的，当程序创建第一个对类的静态成员引用时，就会加载这个类。Java程序在它开始运行之前并非被完全加载，其各个部分是在必需时才加载的。类加载器首先检查这个类的Class对象是否已经加载，如尚未加载，默认的类加载器就会根据类名查找.class文件。在被加载时，会被接受验证，以保证没有被损坏。一旦某个类的Class对象被载入内存，它就被用来创建这个类的所有对象。见typeinfo/SweetShop.java ，static子句在类第一次被加载时执行。

3.无论何时，只要想在运行时使用类型信息，就必须首先获得对恰当的Class对象的引用。Class.forName()就是实现此功能的便捷途径，因为你不需要为了获得Class引用而持有对象。但是如果已经拥有了一个感兴趣的类型对象，那么就可以调用getClass()方法来获得Class引用。Class包含很多方法，见typeinfo/toy/ToyTest.java

4.类字面常量，如Fancy.class，这样做不仅更简单，而且更安全，他在编译时就会受到检查（因此不需要放到try块中），并且根除了对forName()的调用。当使用 .class 来创建对Class对象的引用时，不会自动地初始化该Class对象。为了使用类而做的准备工作实际包含三个步骤：

-   加载，由类加载器执行，该步骤将查找字节码，并从这些字节码中创建一个Class对象。
-   链接，在链接阶段将严重类中的字节码，为静态域分配存储空间，并且如果需要的话，将解析这个类创建对其他类的所有引用
-   初始化，如果该类有超类，则对其初始化，执行静态初始化器和静态初始化块。